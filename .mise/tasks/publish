#!/usr/bin/env bash
#MISE description="Publish to npm registry"
#MISE depends=["setup", "build"]
#USAGE flag "-t --tag <tag>" "Tag to publish with" default="latest"

set -e

echo "Publishing to npm"
echo " > with tag: ${usage_tag}..."
echo " > npm version: $(npm --version)"

# Bump prerelease version if tag is "next"
if [ "${usage_tag}" = "next" ]; then
  echo "Bumping prerelease version..."
  bun pm version prerelease
fi

# Publish directly from source (allows provenance generation)
# In GitHub Actions with OIDC, provenance is automatically generated
npm publish \
  --access public \
  --tag "${usage_tag}"

echo "Published successfully!"
