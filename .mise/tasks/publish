#!/usr/bin/env bash
#MISE description="Publish to npm registry"
#MISE depends=["setup", "build"]
#USAGE flag "-t --tag <tag>" "Tag to publish with" default="latest"

set -e

# Pack with bun (leverages all bun build aspects)
TARBALL=$(bun publish --dry-run --quiet 2>&1 | tail -1)
echo "Packed tarball: $TARBALL"

# Publish with npm (better OIDC support in CI)
npm publish \
  --access public \
  --tag "${usage_tag}" \
  "$TARBALL"
